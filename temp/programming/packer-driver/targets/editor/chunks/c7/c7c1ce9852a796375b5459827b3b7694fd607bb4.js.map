{"version":3,"sources":["file:///C:/Users/jmluc/FracturableObjects/assets/Scripts/Voronoi.ts"],"names":["Point","VEdge","VQueue","VPolygon","VParabola","VEvent","_decorator","Graphics","ccclass","property","constructor","x","y","cell","distance","t","n","Math","sqrt","i","h","left","right","start","end","f","g","direction","B","intersected","iCounted","neighbour","q","enqueue","push","dequeue","sort","sortOnY","pop","remove","e","index","length","splice","isEmpty","clear","b","a","size","vertices","first","last","addRight","p","addLeft","vs","cEvent","parent","_left","_right","site","isLeaf","edge","point","pe","key","random","arch","value","compare","other","sortVEvent","evenA","eventB","sortPoint_by_y","pointA","pointB","Voronoi","places","edges","cells","queue","width","height","root","ly","lasty","firstPoint","GetCells","insertParabola","fp","s","par","GetParabolaByX","GetY","el","er","p0","p1","p2","CheckCircle","GetRight","GetRightChild","GetRightParent","GetLeftParent","pLast","GetLeftChild","drawPoints","Compute","GetEdges","console","log","drawEdges","drawCells","moveTo","j","lineTo","close","fill","update","deltaTime","GetLineIntersection","a1","a2","b1","b2","dax","dbx","day","dby","Den","A","I","ev","RemoveParabola","FinishEdge","circle","stroke","xl","xr","higher","gparent","mx","max","min","GetXOfEdge","r","dp","c1","c2","c","disc","x1","x2","ry","xx","lp","rp","GetEdgeIntersection","d","wd","GetLeft"],"mappings":";;;wFAIMA,K,EAcAC,K,EA6BAC,M,EAuCAC,Q,EA0BAC,S,EAiCAC,M;;;;;;;AAjJGC,MAAAA,U,OAAAA,U;AAAuBC,MAAAA,Q,OAAAA,Q;;;;;;;;;OAC1B;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBH,U;AAGxBN,MAAAA,K,GAAN,MAAMA,KAAN,CAAY;AAIRU,QAAAA,WAAW,CAACC,CAAD,EAAYC,CAAZ,EAAuB;AAAA,eAH3BD,CAG2B;AAAA,eAF3BC,CAE2B;AAAA,eADlCC,IACkC;AAC9B,eAAKF,CAAL,GAASA,CAAT;AACA,eAAKC,CAAL,GAASA,CAAT;AACH;;AAPO,O;;AAANZ,MAAAA,K,CASKc,Q,GAAW,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAC9B,eAAOC,IAAI,CAACC,IAAL,CAAU,CAACF,CAAC,CAACL,CAAF,GAAMI,CAAC,CAACJ,CAAT,KAAeK,CAAC,CAACL,CAAF,GAAMI,CAAC,CAACJ,CAAvB,IAA4B,CAACK,CAAC,CAACJ,CAAF,GAAMG,CAAC,CAACH,CAAT,KAAeI,CAAC,CAACJ,CAAF,GAAMG,CAAC,CAACH,CAAvB,CAAtC,CAAP;AACH,O;;AAGCX,MAAAA,K,GAAN,MAAMA,KAAN,CAAY;AAcRS,QAAAA,WAAW,CAACS,CAAD,EAAWJ,CAAX,EAAqBK,CAArB,EAA+B;AAAA,eAZnCC,IAYmC;AAAA,eAXnCC,KAWmC;AAAA,eAVnCC,KAUmC;AAAA,eATnCC,GASmC;AAAA,eARnCC,CAQmC;AAAA,eAPnCC,CAOmC;AAAA,eANnCC,SAMmC;AAAA,eALnCC,CAKmC;AAAA,eAJnCC,WAImC;AAAA,eAHnCC,QAGmC;AAAA,eAFnCC,SAEmC;AAAC;AACvC,eAAKV,IAAL,GAAYN,CAAZ;AACA,eAAKO,KAAL,GAAaF,CAAb;AACA,eAAKG,KAAL,GAAaJ,CAAb;AACA,eAAKK,GAAL,GAAW,IAAX;AACA,eAAKC,CAAL,GAAS,CAACL,CAAC,CAACT,CAAF,GAAMI,CAAC,CAACJ,CAAT,KAAeI,CAAC,CAACH,CAAF,GAAMQ,CAAC,CAACR,CAAvB,CAAT;AACA,eAAKc,CAAL,GAASP,CAAC,CAACP,CAAF,GAAM,KAAKa,CAAL,GAASN,CAAC,CAACR,CAA1B;AACA,eAAKgB,SAAL,GAAiB,IAAI3B,KAAJ,CAAUoB,CAAC,CAACR,CAAF,GAAMG,CAAC,CAACH,CAAlB,EAAqB,EAAEQ,CAAC,CAACT,CAAF,GAAMI,CAAC,CAACJ,CAAV,CAArB,CAAjB;AACA,eAAKiB,CAAL,GAAS,IAAI5B,KAAJ,CAAUmB,CAAC,CAACR,CAAF,GAAM,KAAKgB,SAAL,CAAehB,CAA/B,EAAkCQ,CAAC,CAACP,CAAF,GAAM,KAAKe,SAAL,CAAef,CAAvD,CAAT,CARsC,CAQ4B;;AAClE,eAAKiB,WAAL,GAAmB,KAAnB;AACA,eAAKC,QAAL,GAAgB,KAAhB;AACA,eAAKC,SAAL,GAAiB,IAAjB;AACH;;AA1BO,O;AA6BN7B,MAAAA,M,GAAN,MAAMA,MAAN,CAAa;AAITQ,QAAAA,WAAW,GAAG;AAAA,eAHPsB,CAGO,GAHH,EAGG;AAAA,eAFPb,CAEO,GAFH,CAEG;;AAAA,eAOdc,OAPc,GAOJ,UAAUlB,CAAV,EAAqB;AAC3B,iBAAKiB,CAAL,CAAOE,IAAP,CAAYnB,CAAZ;AACH,WATa;;AAAA,eAUdoB,OAVc,GAUJ,YAAY;AACnB,iBAAKH,CAAL,CAAOI,IAAP,CAAY,KAAKC,OAAjB;AACC,mBAAS,KAAKL,CAAL,CAAOM,GAAP,EAAT;AACH,WAba;;AAAA,eAcdC,MAdc,GAcL,UAAUC,CAAV,EAAa;AAClB,gBAAIC,KAAK,GAAG,CAAC,CAAb;;AACA,iBAAK,KAAKtB,CAAL,GAAS,CAAd,EAAiB,KAAKA,CAAL,GAAS,KAAKa,CAAL,CAAOU,MAAjC,EAAyC,KAAKvB,CAAL,EAAzC,EACI,IAAI,KAAKa,CAAL,CAAO,KAAKb,CAAZ,KAAkBqB,CAAtB,EAAyB;AACrBC,cAAAA,KAAK,GAAE,KAAKtB,CAAZ;AACA;AACH;;AACL,iBAAKa,CAAL,CAAOW,MAAP,CAAcF,KAAd,EAAqB,CAArB;AACH,WAtBa;;AAAA,eAuBdG,OAvBc,GAuBJ,YAAY;AAClB,mBAAS,KAAKZ,CAAL,CAAOU,MAAP,IAAe,CAAxB;AACH,WAzBa;;AAAA,eA0BdG,KA1Bc,GA0BN,UAAUC,CAAV,EAAa;AACjB,iBAAKd,CAAL,GAAS,EAAT;AACH,WA5Ba;AAEb;;AAEDK,QAAAA,OAAO,CAACU,CAAD,EAAID,CAAJ,EAAO;AACV,iBAAOC,CAAC,CAACnC,CAAF,GAAMkC,CAAC,CAAClC,CAAR,GAAY,CAAZ,GAAgB,CAAC,CAAxB;AACH;;AAVQ,O,EAqCb;AACA;;AACMT,MAAAA,Q,GAAN,MAAMA,QAAN,CAAe;AAKXO,QAAAA,WAAW,GAAG;AAAA,eAJPsC,IAIO,GAJA,CAIA;AAAA,eAHPC,QAGO,GAHI,EAGJ;AAAA,eAFPC,KAEO,GAFC,IAED;AAAA,eADPC,IACO,GADA,IACA;;AAAA,eAGdC,QAHc,GAGH,UAAUC,CAAV,EAAa;AACpB,iBAAKJ,QAAL,CAAcf,IAAd,CAAmBmB,CAAnB;AACA,cAAE,KAAKL,IAAP;AACA,iBAAKG,IAAL,GAAYE,CAAZ;AACA,gBAAG,KAAKL,IAAL,IAAW,CAAd,EAAiB,KAAKE,KAAL,GAAaG,CAAb;AACpB,WARa;;AAAA,eASdC,OATc,GASJ,UAAUD,CAAV,EAAa;AACnB,gBAAIE,EAAE,GAAG,KAAKN,QAAd;AACA,iBAAKA,QAAL,GAAgB,CAACI,CAAD,CAAhB;;AACA,iBAAI,IAAIlC,CAAC,GAAC,CAAV,EAAaA,CAAC,GAACoC,EAAE,CAACb,MAAlB,EAA0BvB,CAAC,EAA3B,EACI,KAAK8B,QAAL,CAAcf,IAAd,CAAmBqB,EAAE,CAACpC,CAAD,CAArB;;AAEJ,cAAE,KAAK6B,IAAP;AACA,iBAAKE,KAAL,GAAaG,CAAb;AACA,gBAAG,KAAKL,IAAL,IAAW,CAAd,EAAiB,KAAKG,IAAL,GAAYE,CAAZ;AACpB,WAlBa;AAEb;;AAPU,O;AA0BTjD,MAAAA,S,GAAN,MAAMA,SAAN,CAAgB;AAUZM,QAAAA,WAAW,CAACK,CAAD,EAAI;AAAA,eATRyC,MASQ,GATC,IASD;AAAA,eARRC,MAQQ,GARC,IAQD;AAAA,eAPRC,KAOQ,GAPA,IAOA;AAAA,eANRC,MAMQ,GANC,IAMD;AAAA,eALRC,IAKQ;AAAA,eAJRC,MAIQ;AAAA,eAHRC,IAGQ;AAEX,eAAKF,IAAL,GAAY7C,CAAZ;AACA,eAAK8C,MAAL,GAAe,KAAKD,IAAL,IAAa,IAA5B;AACH;;AACO,YAAJvC,IAAI,GAAE;AACN,iBAAO,KAAKqC,KAAZ;AACH;;AACQ,YAALpC,KAAK,GAAE;AACP,iBAAO,KAAKqC,MAAZ;AACH;;AAEI,YAAJtC,IAAI,CAACgC,CAAD,EAAG;AACJ,eAAKK,KAAL,GAAaL,CAAb;AACNA,UAAAA,CAAC,CAACI,MAAF,GAAW,IAAX;AACG;;AACQ,YAALnC,KAAK,CAAC+B,CAAD,EAAG;AACR,eAAKM,MAAL,GAAcN,CAAd;AACNA,UAAAA,CAAC,CAACI,MAAF,GAAW,IAAX;AACG;;AA7BW,O;AAiCVpD,MAAAA,M,GAAN,MAAMA,MAAN,CAAa;AAQTK,QAAAA,WAAW,CAACK,CAAD,EAAWI,CAAX,EAAuB;AAAA,eAP3B4C,KAO2B;AAAA,eAN3BC,EAM2B;AAAA,eAL3BpD,CAK2B;AAAA,eAJ3BqD,GAI2B,GAJrB,MAAMhD,IAAI,CAACiD,MAAL,EAIe;AAAA,eAH3BC,IAG2B,GAHpB,IAGoB;AAAA,eAF3BC,KAE2B,GAFnB,CAEmB;;AAAA,eAMlCC,OANkC,GAMxB,UAASC,KAAT,EACd;AACC,mBAAQ,KAAK1D,CAAL,GAAO0D,KAAK,CAAC1D,CAAd,GAAiB,CAAjB,GAAmB,CAAC,CAA3B;AACA,WATqC;;AAC9B,eAAKmD,KAAL,GAAahD,CAAb;AACA,eAAKiD,EAAL,GAAU7C,CAAV;AACA,eAAKP,CAAL,GAASG,CAAC,CAACH,CAAX;AAEH;;AAbQ,O;;AAqBP2D,MAAAA,U,GAAa,CAACC,KAAD,EAAgBC,MAAhB,KAAmC;AAElD,YAAID,KAAK,CAAC5D,CAAN,GAAU6D,MAAM,CAAC7D,CAArB,EAAyB;AACrB,iBAAO,CAAC,CAAR;AACH;;AACD,YAAI4D,KAAK,CAAC5D,CAAN,GAAU6D,MAAM,CAAC7D,CAArB,EAAyB;AACrB,iBAAO,CAAP;AACH;;AACD,eAAO,CAAP;AACH,O;;AAEK8D,MAAAA,c,GAAiB,CAACC,MAAD,EAAgBC,MAAhB,KAAkC;AAErD,YAAID,MAAM,CAAC/D,CAAP,GAAWgE,MAAM,CAAChE,CAAtB,EAA0B;AACtB,iBAAO,CAAC,CAAR;AACH;;AACD,YAAI+D,MAAM,CAAC/D,CAAP,GAAWgE,MAAM,CAAChE,CAAtB,EAA0B;AACtB,iBAAO,CAAP;AACH;;AACD,eAAO,CAAP;AACH,O;;yBAOYiE,O,WADZrE,OAAO,CAAC,SAAD,C,gBAAR,MACaqE,OADb,SAC6BtE,QAD7B,CACsC;AAAA;AAAA;AAAA,eAClCuE,MADkC,GAChB,EADgB;AAAA,eAElCC,KAFkC,GAEjB,EAFiB;AAAA,eAGlCC,KAHkC,GAGd,EAHc;AAAA,eAIlCC,KAJkC,GAI1B,IAAI/E,MAAJ,EAJ0B;AAAA,eAKlCgF,KALkC,GAK1B,EAL0B;AAAA,eAMlCC,MANkC,GAMzB,EANyB;AAAA,eAOlCC,IAPkC,GAO3B,IAP2B;AAAA,eAQlCC,EARkC,GAQ7B,CAR6B;AAAA,eASlCC,KATkC,GAS1B,CAT0B;AAAA,eAUlCC,UAVkC,GAUd,IAVc;;AAAA,eAuKlCC,QAvKkC,GAuKvB,YAAY;AACnB,mBAAO,KAAKR,KAAZ;AACH,WAzKiC;;AAAA,eA0KlCS,cA1KkC,GA0KjB,UAAUpC,CAAV,EAAoB;AACjC,gBAAG,CAAC,KAAK+B,IAAT,EAAc;AAAC,mBAAKA,IAAL,GAAY,IAAIhF,SAAJ,CAAciD,CAAd,CAAZ;AAA8B,mBAAKqC,EAAL,GAAUrC,CAAV;AAAa;AAAQ;;AAElE,gBAAG,KAAK+B,IAAL,CAAUvB,MAAV,IAAoB,KAAKuB,IAAL,CAAUxB,IAAV,CAAehD,CAAf,GAAmByC,CAAC,CAACzC,CAArB,GAAwB,IAA/C,EAAqD;AACrD;AACI,qBAAKwE,IAAL,CAAUvB,MAAV,GAAmB,KAAnB;AACA,qBAAKuB,IAAL,CAAU/D,IAAV,GAAiB,IAAIjB,SAAJ,CAAc,KAAKsF,EAAnB,CAAjB;AACA,qBAAKN,IAAL,CAAU9D,KAAV,GAAkB,IAAIlB,SAAJ,CAAciD,CAAd,CAAlB;AACA,oBAAIsC,CAAC,GAAG,IAAI3F,KAAJ,CAAU,CAACqD,CAAC,CAAC1C,CAAF,GAAI,KAAK+E,EAAL,CAAQ/E,CAAb,IAAgB,CAA1B,EAA6B,KAAKwE,MAAlC,CAAR;AACA,oBAAG9B,CAAC,CAAC1C,CAAF,GAAI,KAAK+E,EAAL,CAAQ/E,CAAf,EAAkB,KAAKyE,IAAL,CAAUtB,IAAV,GAAiB,IAAI7D,KAAJ,CAAU0F,CAAV,EAAa,KAAKD,EAAlB,EAAsBrC,CAAtB,CAAjB,CAAlB,KACK,KAAK+B,IAAL,CAAUtB,IAAV,GAAiB,IAAI7D,KAAJ,CAAU0F,CAAV,EAAatC,CAAb,EAAgB,KAAKqC,EAArB,CAAjB;AACL,qBAAKX,KAAL,CAAW7C,IAAX,CAAgB,KAAKkD,IAAL,CAAUtB,IAA1B;AACA;AACH;;AAED,gBAAI8B,GAAG,GAAG,KAAKC,cAAL,CAAoBxC,CAAC,CAAC1C,CAAtB,CAAV;;AAEA,gBAAGiF,GAAG,CAACpC,MAAP,EACA;AACI,mBAAKyB,KAAL,CAAW1C,MAAX,CAAkBqD,GAAG,CAACpC,MAAtB;AACAoC,cAAAA,GAAG,CAACpC,MAAJ,GAAa,IAAb;AACH;;AAED,gBAAIjC,KAAK,GAAG,IAAIvB,KAAJ,CAAUqD,CAAC,CAAC1C,CAAZ,EAAe,KAAKmF,IAAL,CAAUF,GAAG,CAAChC,IAAd,EAAoBP,CAAC,CAAC1C,CAAtB,CAAf,CAAZ;AAEA,gBAAIoF,EAAE,GAAG,IAAI9F,KAAJ,CAAUsB,KAAV,EAAiBqE,GAAG,CAAChC,IAArB,EAA2BP,CAA3B,CAAT;AACA,gBAAI2C,EAAE,GAAG,IAAI/F,KAAJ,CAAUsB,KAAV,EAAiB8B,CAAjB,EAAoBuC,GAAG,CAAChC,IAAxB,CAAT;AAEAmC,YAAAA,EAAE,CAAChE,SAAH,GAAeiE,EAAf;AACA,iBAAKjB,KAAL,CAAW7C,IAAX,CAAgB6D,EAAhB;AAEAH,YAAAA,GAAG,CAAC9B,IAAJ,GAAWkC,EAAX;AACAJ,YAAAA,GAAG,CAAC/B,MAAJ,GAAa,KAAb;AAEA,gBAAIoC,EAAE,GAAG,IAAI7F,SAAJ,CAAcwF,GAAG,CAAChC,IAAlB,CAAT;AACA,gBAAIsC,EAAE,GAAG,IAAI9F,SAAJ,CAAciD,CAAd,CAAT;AACA,gBAAI8C,EAAE,GAAG,IAAI/F,SAAJ,CAAcwF,GAAG,CAAChC,IAAlB,CAAT;AAEAgC,YAAAA,GAAG,CAACtE,KAAJ,GAAY6E,EAAZ;AACAP,YAAAA,GAAG,CAACvE,IAAJ,GAAW,IAAIjB,SAAJ,CAAc,IAAd,CAAX;AACAwF,YAAAA,GAAG,CAACvE,IAAJ,CAASyC,IAAT,GAAgBiC,EAAhB;AAEAH,YAAAA,GAAG,CAACvE,IAAJ,CAASA,IAAT,GAAgB4E,EAAhB;AACAL,YAAAA,GAAG,CAACvE,IAAJ,CAASC,KAAT,GAAiB4E,EAAjB;AAEA,iBAAKE,WAAL,CAAiBH,EAAjB;AACA,iBAAKG,WAAL,CAAiBD,EAAjB;AACH,WAzNiC;;AAAA,eAkYlCE,QAlYkC,GAkYvB,UAAUtF,CAAV,EAAa;AACpB,mBAAO,KAAKuF,aAAL,CAAmB,KAAKC,cAAL,CAAoBxF,CAApB,CAAnB,CAAP;AACH,WApYiC;;AAAA,eAsYlCyF,aAtYkC,GAsYlB,UAAUxF,CAAV,EAAa;AACzB,gBAAI4E,GAAG,GAAG5E,CAAC,CAACyC,MAAZ;AACA,gBAAIgD,KAAK,GAAGzF,CAAZ;;AACA,mBAAM4E,GAAG,CAACvE,IAAJ,IAAYoF,KAAlB,EACA;AACI,kBAAG,CAACb,GAAG,CAACnC,MAAR,EAAgB,OAAO,IAAP;AAChBgD,cAAAA,KAAK,GAAGb,GAAR;AAAaA,cAAAA,GAAG,GAAGA,GAAG,CAACnC,MAAV;AAChB;;AACD,mBAAOmC,GAAP;AACH,WA/YiC;;AAAA,eAiZlCW,cAjZkC,GAiZjB,UAAUvF,CAAV,EAAa;AAC1B,gBAAI4E,GAAG,GAAG5E,CAAC,CAACyC,MAAZ;AACA,gBAAIgD,KAAK,GAAGzF,CAAZ;;AACA,mBAAM4E,GAAG,CAACtE,KAAJ,IAAamF,KAAnB,EACA;AACI,kBAAG,CAACb,GAAG,CAACnC,MAAR,EAAgB,OAAO,IAAP;AAChBgD,cAAAA,KAAK,GAAGb,GAAR;AAAaA,cAAAA,GAAG,GAAGA,GAAG,CAACnC,MAAV;AAChB;;AACD,mBAAOmC,GAAP;AACH,WA1ZiC;;AAAA,eA4ZlCc,YA5ZkC,GA4ZnB,UAAU1F,CAAV,EAAa;AACxB,gBAAG,CAACA,CAAJ,EAAO,OAAO,IAAP;AACP,gBAAI4E,GAAG,GAAG5E,CAAC,CAACK,IAAZ;;AACA,mBAAM,CAACuE,GAAG,CAAC/B,MAAX,EAAmB+B,GAAG,GAAGA,GAAG,CAACtE,KAAV;;AACnB,mBAAOsE,GAAP;AACH,WAjaiC;;AAAA,eAmalCU,aAnakC,GAmalB,UAAUtF,CAAV,EAAa;AACzB,gBAAG,CAACA,CAAJ,EAAO,OAAO,IAAP;AACP,gBAAI4E,GAAG,GAAG5E,CAAC,CAACM,KAAZ;;AACA,mBAAM,CAACsE,GAAG,CAAC/B,MAAX,EAAmB+B,GAAG,GAAGA,GAAG,CAACvE,IAAV;;AACnB,mBAAOuE,GAAP;AACH,WAxaiC;AAAA;;AAalCrE,QAAAA,KAAK,GAAG;AACJ,cAAI0B,QAAiB,GAAG,EAAxB,CADI,CAKL;;AAMAA,UAAAA,QAAQ,CAACf,IAAT,CAAc,IAAIlC,KAAJ,CAAU,EAAV,EAAa,EAAb,CAAd;AACAiD,UAAAA,QAAQ,CAACf,IAAT,CAAc,IAAIlC,KAAJ,CAAU,EAAV,EAAa,EAAb,CAAd;AACAiD,UAAAA,QAAQ,CAACf,IAAT,CAAc,IAAIlC,KAAJ,CAAU,CAAV,EAAY,EAAZ,CAAd;AAIAiD,UAAAA,QAAQ,CAACf,IAAT,CAAc,IAAIlC,KAAJ,CAAU,EAAV,EAAa,EAAb,CAAd;AACAiD,UAAAA,QAAQ,CAACf,IAAT,CAAc,IAAIlC,KAAJ,CAAU,EAAV,EAAa,EAAb,CAAd;AACAiD,UAAAA,QAAQ,CAACf,IAAT,CAAc,IAAIlC,KAAJ,CAAU,EAAV,EAAa,EAAb,CAAd;AAEC,eAAK2G,UAAL,CAAgB1D,QAAhB;AAEA,eAAK2D,OAAL,CAAa3D,QAAb,EAAsB,EAAtB,EAA0B,EAA1B;AACA,cAAIT,CAAC,GAAG,KAAKqE,QAAL,EAAR;AAEAC,UAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ,EA1BI,CA2BN;;AACE,eAAKC,SAAL,CAAexE,CAAf,EA5BI,CA6BN;AAGD;;AAEDyE,QAAAA,SAAS,CAACjC,KAAD,EAAkB;AACvB8B,UAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACAD,UAAAA,OAAO,CAACC,GAAR,CAAY/B,KAAK,CAACtC,MAAlB;;AAGJ,eAAI,IAAIvB,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC6D,KAAK,CAACtC,MAArB,EAA6BvB,CAAC,EAA9B,EACA;AACI2F,YAAAA,OAAO,CAACC,GAAR,CAAY/B,KAAK,CAAC7D,CAAD,CAAjB;AACA,gBAAIkC,CAAC,GAAG2B,KAAK,CAAC7D,CAAD,CAAL,CAAS8B,QAAjB;AACA,gBAAGI,CAAC,CAACX,MAAF,IAAY,CAAf,EAAkB;;AAClB,gBAAGW,CAAC,CAACX,MAAF,IAAY,CAAf,EACA;AACIoE,cAAAA,OAAO,CAACC,GAAR,CAAY/B,KAAK,CAAC7D,CAAD,CAAL,CAAS8B,QAArB;AACA6D,cAAAA,OAAO,CAACC,GAAR,CAAY1D,CAAZ;AACH,aARL,CASE;AACC;;;AACC,iBAAK6D,MAAL,CAAY7D,CAAC,CAAC,CAAD,CAAD,CAAK1C,CAAjB,EAAoB0C,CAAC,CAAC,CAAD,CAAD,CAAKzC,CAAzB;;AACA,iBAAI,IAAIuG,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC9D,CAAC,CAACX,MAAjB,EAAyByE,CAAC,EAA1B,EAA6B;AACzB,mBAAKC,MAAL,CAAY/D,CAAC,CAAC8D,CAAD,CAAD,CAAKxG,CAAjB,EAAoB0C,CAAC,CAAC8D,CAAD,CAAD,CAAKvG,CAAzB;AACH;;AACF,iBAAKyG,KAAL;AACA,iBAAKC,IAAL;AACF;AACJ;;AAGGC,QAAAA,MAAM,CAACC,SAAD,EAAoB,CAEzB;;AACDC,QAAAA,mBAAmB,CAACC,EAAD,EAAKC,EAAL,EAASC,EAAT,EAAaC,EAAb,EAAiB;AAChC,cAAIC,GAAG,GAAIJ,EAAE,CAAC/G,CAAH,GAAKgH,EAAE,CAAChH,CAAnB;AAAA,cAAuBoH,GAAG,GAAIH,EAAE,CAACjH,CAAH,GAAKkH,EAAE,CAAClH,CAAtC;AACA,cAAIqH,GAAG,GAAIN,EAAE,CAAC9G,CAAH,GAAK+G,EAAE,CAAC/G,CAAnB;AAAA,cAAuBqH,GAAG,GAAIL,EAAE,CAAChH,CAAH,GAAKiH,EAAE,CAACjH,CAAtC;AAEA,cAAIsH,GAAG,GAAGJ,GAAG,GAACG,GAAJ,GAAUD,GAAG,GAACD,GAAxB;AACA,cAAIG,GAAG,IAAI,CAAX,EAAc,OAAO,IAAP,CALkB,CAKL;;AAE3B,cAAIC,CAAC,GAAIT,EAAE,CAAC/G,CAAH,GAAOgH,EAAE,CAAC/G,CAAV,GAAc8G,EAAE,CAAC9G,CAAH,GAAO+G,EAAE,CAAChH,CAAjC;AACA,cAAIiB,CAAC,GAAIgG,EAAE,CAACjH,CAAH,GAAOkH,EAAE,CAACjH,CAAV,GAAcgH,EAAE,CAAChH,CAAH,GAAOiH,EAAE,CAAClH,CAAjC;AAEA,cAAIyH,CAAC,GAAG,IAAIpI,KAAJ,CAAU,CAAV,EAAY,CAAZ,CAAR;AACAoI,UAAAA,CAAC,CAACzH,CAAF,GAAM,CAAEwH,CAAC,GAACJ,GAAF,GAAQD,GAAG,GAAClG,CAAd,IAAoBsG,GAA1B;AACAE,UAAAA,CAAC,CAACxH,CAAF,GAAM,CAAEuH,CAAC,GAACF,GAAF,GAAQD,GAAG,GAACpG,CAAd,IAAoBsG,GAA1B;AAEA,iBAAOE,CAAP;AAEH;;AAGDxB,QAAAA,OAAO,CAACvD,CAAD,EAAa6B,KAAb,EAA4BC,MAA5B,EAA4C;AAC/C,cAAI9B,CAAC,CAACX,MAAF,GAAW,CAAf,EACI,OAAO,EAAP;AACJ,eAAK0C,IAAL,GAAY,IAAZ;AACA,eAAKN,MAAL,GAAczB,CAAd;AACA,eAAK0B,KAAL,GAAa,EAAb;AACA,eAAKC,KAAL,GAAa,EAAb;AACA,eAAKE,KAAL,GAAaA,KAAb;AACA,eAAKC,MAAL,GAAcA,MAAd,CAR+C,CAW/C;;AACA,eAAKF,KAAL,CAAWpC,KAAX,CAAiB,IAAjB;;AACA,eAAK,IAAI1B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAK2D,MAAL,CAAYpC,MAAhC,EAAwCvB,CAAC,EAAzC,EAA6C;AACzC,gBAAIkH,EAAE,GAAG,IAAIhI,MAAJ,CAAW,KAAKyE,MAAL,CAAY3D,CAAZ,CAAX,EAA2B,IAA3B,CAAT;AACA,gBAAIN,IAAI,GAAG,IAAIV,QAAJ,EAAX;AACA,iBAAK2E,MAAL,CAAY3D,CAAZ,EAAeN,IAAf,GAAsBA,IAAtB;AACA,iBAAKoE,KAAL,CAAWhD,OAAX,CAAmBoG,EAAnB;AACA,iBAAKrD,KAAL,CAAW9C,IAAX,CAAgBrB,IAAhB;AACH;;AAGD,iBAAO,CAAC,KAAKoE,KAAL,CAAWrC,OAAX,EAAR,EAA8B;AAC1B,gBAAIJ,CAAS,GAAG,KAAKyC,KAAL,CAAW9C,OAAX,EAAhB;AACA,iBAAKkD,EAAL,GAAU7C,CAAC,CAACuB,KAAF,CAAQnD,CAAlB;AACA,gBAAG4B,CAAC,CAACwB,EAAL,EAAS,KAAKyB,cAAL,CAAoBjD,CAAC,CAACuB,KAAtB,EAAT,KACK,KAAKuE,cAAL,CAAoB9F,CAApB;AACL,iBAAK8C,KAAL,GAAa9C,CAAC,CAAC5B,CAAf;AACH;;AAED,eAAK2H,UAAL,CAAgB,KAAKnD,IAArB;;AACA,eAAI,IAAIjE,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC,KAAK4D,KAAL,CAAWrC,MAA1B,EAAkCvB,CAAC,EAAnC,EACN,IAAG,KAAK4D,KAAL,CAAW5D,CAAX,EAAcY,SAAjB,EAA4B,KAAKgD,KAAL,CAAW5D,CAAX,EAAcI,KAAd,GAAsB,KAAKwD,KAAL,CAAW5D,CAAX,EAAcY,SAAd,CAAwBP,GAA9C;AACzB;;AAEDmF,QAAAA,UAAU,CAACnE,CAAD,EAAY;AAClB,eAAK,IAAIrB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGqB,CAAC,CAACE,MAAtB,EAA8BvB,CAAC,EAA/B,EAAmC;AAC/B,iBAAKqH,MAAL,CAAYhG,CAAC,CAACrB,CAAD,CAAD,CAAKR,CAAjB,EAAmB6B,CAAC,CAACrB,CAAD,CAAD,CAAKP,CAAxB,EAA0B,CAA1B;AACA,iBAAK0G,IAAL;AACH;AACJ;;AAEDN,QAAAA,SAAS,CAACxE,CAAD,EAAY;AACnB;AACN;AACA;AACA;AAEO;AACC,eAAK,IAAIrB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGqB,CAAC,CAACE,MAAtB,EAA8BvB,CAAC,EAA/B,EAAmC;AAEhC,gBAAIH,CAAC,GAAGwB,CAAC,CAACrB,CAAD,CAAT,CAFgC,CAIjC;;AAEM2F,YAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;AAGJ,iBAAKG,MAAL,CAAYlG,CAAC,CAACO,KAAF,CAAQZ,CAApB,EAAuBK,CAAC,CAACO,KAAF,CAAQX,CAA/B;AACA,iBAAKwG,MAAL,CAAYpG,CAAC,CAACQ,GAAF,CAAMb,CAAlB,EAAqBK,CAAC,CAACQ,GAAF,CAAMZ,CAA3B;AACA,iBAAK6H,MAAL,GAX+B,CAYjC;AAED;AAEJ;;AAED5B,QAAAA,QAAQ,GAAG;AACP,iBAAO,KAAK9B,KAAZ;AACH;;AAsDDuD,QAAAA,cAAc,CAAC9F,CAAD,EAAY;AACtB,cAAI0D,EAAE,GAAG1D,CAAC,CAAC2B,IAAX;AAEA,cAAIuE,EAAE,GAAG,KAAKlC,aAAL,CAAmBN,EAAnB,CAAT;AACA,cAAIyC,EAAE,GAAG,KAAKpC,cAAL,CAAoBL,EAApB,CAAT;AAEA,cAAID,EAAE,GAAG,KAAKS,YAAL,CAAkBgC,EAAlB,CAAT;AACA,cAAIvC,EAAE,GAAG,KAAKG,aAAL,CAAmBqC,EAAnB,CAAT;;AAEA,cAAG1C,EAAE,CAACzC,MAAN,EAAa;AAAC,iBAAKyB,KAAL,CAAW1C,MAAX,CAAkB0D,EAAE,CAACzC,MAArB;AAA8ByC,YAAAA,EAAE,CAACzC,MAAH,GAAY,IAAZ;AAAkB;;AAC9D,cAAG2C,EAAE,CAAC3C,MAAN,EAAa;AAAC,iBAAKyB,KAAL,CAAW1C,MAAX,CAAkB4D,EAAE,CAAC3C,MAArB;AAA8B2C,YAAAA,EAAE,CAAC3C,MAAH,GAAY,IAAZ;AAAkB;;AAE9D,cAAIH,CAAC,GAAG,IAAIrD,KAAJ,CAAUwC,CAAC,CAACuB,KAAF,CAAQpD,CAAlB,EAAqB,KAAKmF,IAAL,CAAUI,EAAE,CAACtC,IAAb,EAAmBpB,CAAC,CAACuB,KAAF,CAAQpD,CAA3B,CAArB,CAAR;AAGA,cAAGsF,EAAE,CAACrC,IAAH,CAAQ/C,IAAR,CAAasC,IAAb,IAAqB+C,EAAE,CAACtC,IAAH,CAAQ/C,IAAR,CAAaqC,KAArC,EAA6CgD,EAAE,CAACtC,IAAH,CAAQ/C,IAAR,CAAayC,OAAb,CAAqBD,CAArB,EAA7C,KACK6C,EAAE,CAACtC,IAAH,CAAQ/C,IAAR,CAAauC,QAAb,CAAsBC,CAAtB;AAEL4C,UAAAA,EAAE,CAACrC,IAAH,CAAQ/C,IAAR,CAAauC,QAAb,CAAsBC,CAAtB;AACA8C,UAAAA,EAAE,CAACvC,IAAH,CAAQ/C,IAAR,CAAayC,OAAb,CAAqBD,CAArB;AAEA,eAAKiC,KAAL,GAAa9C,CAAC,CAACuB,KAAF,CAAQnD,CAArB;AAEA8H,UAAAA,EAAE,CAAC5E,IAAH,CAAQtC,GAAR,GAAc6B,CAAd;AACAsF,UAAAA,EAAE,CAAC7E,IAAH,CAAQtC,GAAR,GAAc6B,CAAd;AAEA,cAAIuF,MAAJ;AACA,cAAIhD,GAAG,GAAGM,EAAV;;AACA,iBAAMN,GAAG,IAAI,KAAKR,IAAlB,EACA;AACIQ,YAAAA,GAAG,GAAGA,GAAG,CAACnC,MAAV;;AACA,gBAAGmC,GAAG,IAAI8C,EAAV,EAAc;AAACE,cAAAA,MAAM,GAAGF,EAAT;AAAa;;AAC5B,gBAAG9C,GAAG,IAAI+C,EAAV,EAAc;AAACC,cAAAA,MAAM,GAAGD,EAAT;AAAa;AAC/B;;AAEDC,UAAAA,MAAM,CAAC9E,IAAP,GAAc,IAAI7D,KAAJ,CAAUoD,CAAV,EAAa4C,EAAE,CAACrC,IAAhB,EAAsBuC,EAAE,CAACvC,IAAzB,CAAd;AAEA,eAAKmB,KAAL,CAAW7C,IAAX,CAAgB0G,MAAM,CAAC9E,IAAvB;AAEA,cAAI+E,OAAO,GAAG3C,EAAE,CAACzC,MAAH,CAAUA,MAAxB;;AACA,cAAGyC,EAAE,CAACzC,MAAH,CAAUpC,IAAV,IAAkB6E,EAArB,EACA;AACI,gBAAG2C,OAAO,CAACxH,IAAR,IAAiB6E,EAAE,CAACzC,MAAvB,EAA+BoF,OAAO,CAACxH,IAAR,GAAgB6E,EAAE,CAACzC,MAAH,CAAUnC,KAA1B,CAA/B,KACK4E,EAAE,CAACzC,MAAH,CAAUA,MAAV,CAAiBnC,KAAjB,GAAyB4E,EAAE,CAACzC,MAAH,CAAUnC,KAAnC;AACR,WAJD,MAMA;AACI,gBAAGuH,OAAO,CAACxH,IAAR,IAAiB6E,EAAE,CAACzC,MAAvB,EAA+BoF,OAAO,CAACxH,IAAR,GAAgB6E,EAAE,CAACzC,MAAH,CAAUpC,IAA1B,CAA/B,KACKwH,OAAO,CAACvH,KAAR,GAAgB4E,EAAE,CAACzC,MAAH,CAAUpC,IAA1B;AACR;;AAED,eAAK+E,WAAL,CAAiBH,EAAjB;AACA,eAAKG,WAAL,CAAiBD,EAAjB;AACH;;AAEDoC,QAAAA,UAAU,CAACvH,CAAD,EAAI;AACV,cAAI8H,EAAJ;;AACA,cAAG9H,CAAC,CAAC8C,IAAF,CAAOnC,SAAP,CAAiBhB,CAAjB,GAAqB,GAAxB,EACA;AACImI,YAAAA,EAAE,GAAG7H,IAAI,CAAC8H,GAAL,CAAS,KAAK7D,KAAd,EAAqBlE,CAAC,CAAC8C,IAAF,CAAOvC,KAAP,CAAaZ,CAAb,GAAiB,EAAtC,CAAL;AACH,WAHD,MAKA;AACImI,YAAAA,EAAE,GAAG7H,IAAI,CAAC+H,GAAL,CAAS,GAAT,EAAchI,CAAC,CAAC8C,IAAF,CAAOvC,KAAP,CAAaZ,CAAb,GAAiB,EAA/B,CAAL;AACH;;AACDK,UAAAA,CAAC,CAAC8C,IAAF,CAAOtC,GAAP,GAAa,IAAIxB,KAAJ,CAAU8I,EAAV,EAAc9H,CAAC,CAAC8C,IAAF,CAAOrC,CAAP,GAASqH,EAAT,GAAc9H,CAAC,CAAC8C,IAAF,CAAOpC,CAAnC,CAAb;AAEA,cAAG,CAACV,CAAC,CAACK,IAAF,CAAOwC,MAAX,EAAoB,KAAK0E,UAAL,CAAgBvH,CAAC,CAACK,IAAlB;AACpB,cAAG,CAACL,CAAC,CAACM,KAAF,CAAQuC,MAAZ,EAAoB,KAAK0E,UAAL,CAAgBvH,CAAC,CAACM,KAAlB;AACvB;;AAED2H,QAAAA,UAAU,CAACrD,GAAD,EAAKhF,CAAL,EAAQ;AAErB,cAAIS,IAAI,GAAG,KAAKqF,YAAL,CAAmBd,GAAnB,CAAX;AACA,cAAItE,KAAK,GAAG,KAAKgF,aAAL,CAAmBV,GAAnB,CAAZ;AAEA,cAAIvC,CAAC,GAAGhC,IAAI,CAACuC,IAAb;AACA,cAAIsF,CAAC,GAAG5H,KAAK,CAACsC,IAAd;AAEA,cAAIuF,EAAE,GAAG,KAAG9F,CAAC,CAACzC,CAAF,GAAMA,CAAT,CAAT;AACA,cAAI8G,EAAE,GAAG,IAAEyB,EAAX;AACA,cAAIvB,EAAE,GAAG,CAAC,CAAD,GAAGvE,CAAC,CAAC1C,CAAL,GAAOwI,EAAhB;AACA,cAAIC,EAAE,GAAGxI,CAAC,GAACuI,EAAE,GAAC,IAAL,GAAY9F,CAAC,CAAC1C,CAAF,GAAI0C,CAAC,CAAC1C,CAAN,GAAQwI,EAA7B;AAEAA,UAAAA,EAAE,GAAG,KAAGD,CAAC,CAACtI,CAAF,GAAMA,CAAT,CAAL;AACA,cAAI+G,EAAE,GAAG,IAAEwB,EAAX;AACA,cAAItB,EAAE,GAAG,CAAC,CAAD,GAAGqB,CAAC,CAACvI,CAAL,GAAOwI,EAAhB;AACA,cAAIE,EAAE,GAAGzI,CAAC,GAACuI,EAAE,GAAC,IAAL,GAAYD,CAAC,CAACvI,CAAF,GAAIuI,CAAC,CAACvI,CAAN,GAAQwI,EAA7B;AAEA,cAAIpG,CAAC,GAAG2E,EAAE,GAAGC,EAAb;AACA,cAAI7E,CAAC,GAAG8E,EAAE,GAAGC,EAAb;AACA,cAAIyB,CAAC,GAAGF,EAAE,GAAGC,EAAb;AAEA,cAAGtG,CAAC,IAAE,CAAN,EAAS,OAAO,CAACuG,CAAD,GAAGxG,CAAV;AAET,cAAIyG,IAAI,GAAGzG,CAAC,GAACA,CAAF,GAAM,IAAIC,CAAJ,GAAQuG,CAAzB;AACA,cAAIE,EAAE,GAAG,CAAC,CAAC1G,CAAD,GAAK7B,IAAI,CAACC,IAAL,CAAUqI,IAAV,CAAN,KAA0B,IAAExG,CAA5B,CAAT;AACA,cAAI0G,EAAE,GAAG,CAAC,CAAC3G,CAAD,GAAK7B,IAAI,CAACC,IAAL,CAAUqI,IAAV,CAAN,KAA0B,IAAExG,CAA5B,CAAT;AAEA,cAAI2G,EAAJ;AACA,cAAGrG,CAAC,CAACzC,CAAF,GAAMsI,CAAC,CAACtI,CAAX,EAAe8I,EAAE,GAAIzI,IAAI,CAAC8H,GAAL,CAASS,EAAT,EAAaC,EAAb,CAAN,CAAf,KACKC,EAAE,GAAGzI,IAAI,CAAC+H,GAAL,CAASQ,EAAT,EAAaC,EAAb,CAAL;AAEL,iBAAOC,EAAP;AACI;;AAED7D,QAAAA,cAAc,CAAC8D,EAAD,EAAK;AACf;AACI,gBAAI/D,GAAG,GAAG,KAAKR,IAAf;AACA,gBAAIzE,CAAC,GAAG,CAAR;;AAEA,mBAAM,CAACiF,GAAG,CAAC/B,MAAX,EACA;AACIlD,cAAAA,CAAC,GAAG,KAAKsI,UAAL,CAAgBrD,GAAhB,EAAqB,KAAKP,EAA1B,CAAJ;AACA,kBAAG1E,CAAC,GAACgJ,EAAL,EAAS/D,GAAG,GAAGA,GAAG,CAACvE,IAAV,CAAT,KACKuE,GAAG,GAAGA,GAAG,CAACtE,KAAV;AACR;;AACD,mBAAOsE,GAAP;AACH;AACJ;;AAEDE,QAAAA,IAAI,CAACzC,CAAD,EAAI1C,CAAJ,EAAO;AACP,cAAIwI,EAAE,GAAG,KAAG9F,CAAC,CAACzC,CAAF,GAAM,KAAKyE,EAAd,CAAT;AACA,cAAIuC,EAAE,GAAG,CAAC,CAAD,GAAGvE,CAAC,CAAC1C,CAAL,GAAOwI,EAAhB;AACA,cAAIC,EAAE,GAAG,KAAK/D,EAAL,GAAQ8D,EAAE,GAAC,CAAX,GAAe9F,CAAC,CAAC1C,CAAF,GAAI0C,CAAC,CAAC1C,CAAN,GAAQwI,EAAhC;AAEA,iBAAOxI,CAAC,GAACA,CAAF,GAAIwI,EAAJ,GAASvB,EAAE,GAACjH,CAAZ,GAAgByI,EAAvB;AACH;;AAEDhD,QAAAA,WAAW,CAACtD,CAAD,EAAI;AACX,cAAI8G,EAAE,GAAG,KAAKpD,aAAL,CAAmB1D,CAAnB,CAAT;AACP,cAAI+G,EAAE,GAAG,KAAKtD,cAAL,CAAoBzD,CAApB,CAAT;AAEA,cAAIC,CAAC,GAAG,KAAK2D,YAAL,CAAkBkD,EAAlB,CAAR;AACA,cAAIN,CAAC,GAAG,KAAKhD,aAAL,CAAmBuD,EAAnB,CAAR;AAEA,cAAG,CAAC9G,CAAD,IAAM,CAACuG,CAAP,IAAYvG,CAAC,CAACa,IAAF,IAAU0F,CAAC,CAAC1F,IAA3B,EAAiC;AAEjC,cAAI+B,CAAC,GAAG,KAAKmE,mBAAL,CAAyBF,EAAE,CAAC9F,IAA5B,EAAkC+F,EAAE,CAAC/F,IAArC,CAAR;AACA,cAAG,CAAC6B,CAAJ,EAAO;AAEP,cAAIoE,CAAC,GAAG/J,KAAK,CAACc,QAAN,CAAeiC,CAAC,CAACa,IAAjB,EAAuB+B,CAAvB,CAAR,CAZkB,CAalB;;AACA,cAAGA,CAAC,CAAC/E,CAAF,GAAMmJ,CAAN,IAAY,KAAK1E,EAApB,EAAwB;AAExB,cAAI7C,CAAC,GAAG,IAAInC,MAAJ,CAAW,IAAIL,KAAJ,CAAU2F,CAAC,CAAChF,CAAZ,EAAegF,CAAC,CAAC/E,CAAF,GAAMmJ,CAArB,CAAX,EAAoC,KAApC,CAAR;AAEAjH,UAAAA,CAAC,CAACU,MAAF,GAAWhB,CAAX;AACAA,UAAAA,CAAC,CAAC2B,IAAF,GAASrB,CAAT;AACA,eAAKmC,KAAL,CAAWhD,OAAX,CAAmBO,CAAnB;AACI;;AAEDsH,QAAAA,mBAAmB,CAAC/G,CAAD,EAAID,CAAJ,EAAO;AACtB,cAAIsF,CAAC,GAAG,KAAKX,mBAAL,CAAyB1E,CAAC,CAACxB,KAA3B,EAAkCwB,CAAC,CAACnB,CAApC,EAAuCkB,CAAC,CAACvB,KAAzC,EAAgDuB,CAAC,CAAClB,CAAlD,CAAR,CADsB,CAGtB;;AACA,cAAIoI,EAAE,GAAI,CAAC5B,CAAC,CAACzH,CAAF,GAAMoC,CAAC,CAACxB,KAAF,CAAQZ,CAAf,IAAkBoC,CAAC,CAACpB,SAAF,CAAYhB,CAA9B,GAAgC,CAAhC,IAAqC,CAACyH,CAAC,CAACxH,CAAF,GAAMmC,CAAC,CAACxB,KAAF,CAAQX,CAAf,IAAkBmC,CAAC,CAACpB,SAAF,CAAYf,CAA9B,GAAgC,CAArE,IACE,CAACwH,CAAC,CAACzH,CAAF,GAAMmC,CAAC,CAACvB,KAAF,CAAQZ,CAAf,IAAkBmC,CAAC,CAACnB,SAAF,CAAYhB,CAA9B,GAAgC,CADlC,IACuC,CAACyH,CAAC,CAACxH,CAAF,GAAMkC,CAAC,CAACvB,KAAF,CAAQX,CAAf,IAAkBkC,CAAC,CAACnB,SAAF,CAAYf,CAA9B,GAAgC,CADjF;AAGA,cAAGoJ,EAAH,EAAO,OAAO,IAAP;AACP,iBAAO5B,CAAP;AACH;;AAED6B,QAAAA,OAAO,CAAClJ,CAAD,EAAI;AACP,iBAAO,KAAK2F,YAAL,CAAkB,KAAKF,aAAL,CAAmBzF,CAAnB,CAAlB,CAAP;AACH;;AAhYiC,O","sourcesContent":["import { _decorator, Component, Graphics, Node, Vec2 } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n\r\nclass Point {\r\n    public x: number;\r\n    public y: number;\r\n    cell: VPolygon;\r\n    constructor(x: number, y: number) {\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n\r\n    static distance = function (t, n) {\r\n        return Math.sqrt((n.x - t.x) * (n.x - t.x) + (n.y - t.y) * (n.y - t.y))\r\n    }\r\n}\r\n\r\nclass VEdge {\r\n\r\n    public left: Point;\r\n    public right: Point;\r\n    public start: Point;\r\n    public end: Point;\r\n    public f: number\r\n    public g: number\r\n    public direction: Point;\r\n    public B: Point;\r\n    public intersected: boolean;\r\n    public iCounted: boolean;\r\n    public neighbour;\r\n\r\n    constructor(i: Point, t: Point, h: Point) {// start, left, right\r\n        this.left = t\r\n        this.right = h\r\n        this.start = i\r\n        this.end = null\r\n        this.f = (h.x - t.x) / (t.y - h.y)\r\n        this.g = i.y - this.f * i.x\r\n        this.direction = new Point(h.y - t.y, -(h.x - t.x))\r\n        this.B = new Point(i.x + this.direction.x, i.y + this.direction.y)// second point of line\r\n        this.intersected = false;\r\n        this.iCounted = false;\r\n        this.neighbour = null;\r\n    }\r\n}\r\n\r\nclass VQueue {\r\n    public q = [];\r\n    public i = 0\r\n\r\n    constructor() {\r\n\r\n    }\r\n\r\n    sortOnY(a, b) {\r\n        return a.y > b.y ? 1 : -1\r\n    }\r\n    enqueue = function (t: VEvent) {\r\n        this.q.push(t)\r\n    }\r\n    dequeue = function () {\r\n       this.q.sort(this.sortOnY)\r\n        return ( this.q.pop())\r\n    }\r\n    remove = function (e) {\r\n        var index = -1;\r\n        for (this.i = 0; this.i < this.q.length; this.i++)\r\n            if (this.q[this.i] == e) {\r\n                index= this.i\r\n                break\r\n            }\r\n        this.q.splice(index, 1)\r\n    }\r\n    isEmpty = function () {\r\n        return ( this.q.length==0)\r\n    }\r\n    clear = function (b) {\r\n        this.q = []\r\n    }\r\n}\r\n\r\n\r\n\r\n// counter clock wise\r\n// (-1,1), (1,1), (1,-1), (-1,-1)\r\nclass VPolygon {\r\n    public size = 0\r\n    public vertices = []\r\n    public first = null\r\n    public last = null\r\n    constructor() {\r\n\r\n    }\r\n    addRight = function (p) {\r\n        this.vertices.push(p);\r\n        ++this.size;\r\n        this.last = p;\r\n        if(this.size==1) this.first = p;\r\n    }\r\n    addLeft = function (p) {\r\n        var vs = this.vertices;\r\n        this.vertices = [p];\r\n        for(var i=0; i<vs.length; i++) \r\n            this.vertices.push(vs[i]);\r\n            \r\n        ++this.size;\r\n        this.first = p;\r\n        if(this.size==1) this.last = p\r\n    }\r\n}\r\n\r\nclass VParabola {\r\n    public cEvent = null\r\n    public parent = null\r\n    public _left = null\r\n    public _right = null\r\n    public site;\r\n    public isLeaf;\r\n    public edge;\r\n \r\n\r\n    constructor(t) {\r\n\r\n        this.site = t;\r\n        this.isLeaf = (this.site != null);\r\n    }\r\n    get left(){\r\n        return this._left;\r\n    } \r\n    get right(){\r\n        return this._right;\r\n    } \r\n\t\r\n\tset left(p){\r\n        this._left = p;\r\n\t\tp.parent = this;\r\n    } \r\n    set right(p){\r\n        this._right = p;\r\n\t\tp.parent = this;\r\n    }\r\n\r\n}\r\n\r\nclass VEvent {\r\n    public point: Point\r\n    public pe;\r\n    public y;\r\n    public key = 1e8 * Math.random()\r\n    public arch = null\r\n    public value = 0\r\n\r\n    constructor(t: Point, i: boolean) {\r\n        this.point = t;\r\n        this.pe = i;\r\n        this.y = t.y\r\n\r\n    }\r\n    compare = function(other)\r\n{\r\n\treturn((this.y>other.y)?1:-1);\r\n}\r\n \r\n}\r\n\r\nconst sortVEvent = (evenA: VEvent, eventB: VEvent) => {\r\n    \r\n    if (evenA.y < eventB.y ) {\r\n        return -1;\r\n    }\r\n    if (evenA.y > eventB.y ) {\r\n        return 1;\r\n    }\r\n    return 0;\r\n}\r\n\r\nconst sortPoint_by_y = (pointA: Point, pointB: Point) => {\r\n    \r\n    if (pointA.y < pointB.y ) {\r\n        return -1;\r\n    }\r\n    if (pointA.y > pointB.y ) {\r\n        return 1;\r\n    }\r\n    return 0;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n@ccclass('Voronoi')\r\nexport class Voronoi extends Graphics {\r\n    places: Point[] = []\r\n    edges: VEdge[] = []\r\n    cells: VPolygon[] = [];\r\n    queue = new VQueue;\r\n    width = 40      \r\n    height = 60\r\n    root = null\r\n    ly = 0\r\n    lasty = 0\r\n    firstPoint: Point = null\r\n\r\n\r\n    start() {\r\n        let vertices: Point[] = [];\r\n\r\n  \r\n       \r\n       //vertices.push(new Point(20,40))\r\n \r\n  \r\n       \r\n   \r\n \r\n       vertices.push(new Point(15,20))\r\n       vertices.push(new Point(20,42))\r\n       vertices.push(new Point(8,40))\r\n \r\n \r\n \r\n       vertices.push(new Point(10,13))\r\n       vertices.push(new Point(18,43))\r\n       vertices.push(new Point(30,50))\r\n       \r\n        this.drawPoints(vertices)\r\n\r\n        this.Compute(vertices,40, 60);\r\n        let e = this.GetEdges();\r\n \r\n        console.log(\":::::::::::::\")\r\n      //  console.log(e)\r\n        this.drawEdges(e)\r\n      //  this.drawCells(c);\r\n\r\n\r\n    }\r\n\r\n    drawCells(cells:VPolygon[]){\r\n        console.log(\"DRAW CELLS\")\r\n        console.log(cells.length)\r\n\r\n   \r\n    for(var i=0; i<cells.length; i++)\r\n    {\r\n        console.log(cells[i])\r\n        var p = cells[i].vertices;\r\n        if(p.length == 0) continue;\r\n        if(p.length == 4)\r\n        {\r\n            console.log(cells[i].vertices);\r\n            console.log(p);\r\n        }\r\n      //  c.fillStyle = colors[i];\r\n       // c.beginPath();\r\n        this.moveTo(p[0].x, p[0].y);\r\n        for(var j=1; j<p.length; j++){\r\n            this.lineTo(p[j].x, p[j].y);\r\n        }\r\n       this.close();\r\n       this.fill();\r\n    }\r\n}\r\n \r\n\r\n    update(deltaTime: number) {\r\n\r\n    }\r\n    GetLineIntersection(a1, a2, b1, b2) {\r\n        var dax = (a1.x-a2.x), dbx = (b1.x-b2.x);\r\n        var day = (a1.y-a2.y), dby = (b1.y-b2.y);\r\n                \r\n        var Den = dax*dby - day*dbx;\r\n        if (Den == 0) return null;\t// parallel\r\n    \r\n        var A = (a1.x * a2.y - a1.y * a2.x);\r\n        var B = (b1.x * b2.y - b1.y * b2.x);\r\n            \r\n        var I = new Point(0,0);\r\n        I.x = ( A*dbx - dax*B ) / Den;\r\n        I.y = ( A*dby - day*B ) / Den;\r\n        \r\n        return I;\r\n    \r\n    }\r\n\r\n\r\n    Compute(p: Point[], width: number, height: number) {\r\n        if (p.length < 2)\r\n            return [];\r\n        this.root = null\r\n        this.places = p\r\n        this.edges = []\r\n        this.cells = []\r\n        this.width = width\r\n        this.height = height\r\n   \r\n \r\n        //  this.queue.clear(!0)\r\n        this.queue.clear(true)\r\n        for (let i = 0; i < this.places.length; i++) {\r\n            let ev = new VEvent(this.places[i], true)\r\n            let cell = new VPolygon();\r\n            this.places[i].cell = cell\r\n            this.queue.enqueue(ev)\r\n            this.cells.push(cell)\r\n        }\r\n      \r\n \r\n        while (!this.queue.isEmpty()) {\r\n            var e: VEvent = this.queue.dequeue();\r\n            this.ly = e.point.y;\r\n            if(e.pe) this.insertParabola(e.point);\r\n            else this.RemoveParabola(e);\r\n            this.lasty = e.y;\r\n        }\r\n\r\n        this.FinishEdge(this.root)\r\n        for(let i=0; i<this.edges.length; i++)\r\n\t\tif(this.edges[i].neighbour) this.edges[i].start = this.edges[i].neighbour.end;\r\n    }\r\n\r\n    drawPoints(e:Point[]) {\r\n        for (let i = 0; i < e.length; i++) {\r\n            this.circle(e[i].x,e[i].y,1);\r\n            this.fill();\r\n        }\r\n    }\r\n\r\n    drawEdges(e:VEdge[]) {\r\n      /*  console.log(\"DRAWINGGG\")\r\n        e.forEach(element => {\r\n            console.log(element)\r\n        });*/\r\n \r\n       // this.moveTo(n.left.x, n.left.y);\r\n        for (let i = 0; i < e.length; i++) {\r\n            \r\n           let n = e[i];\r\n       \r\n          //  if(n.end==null) {n.end=n.left}\r\n      \r\n                console.log(\"DRAW\")\r\n\r\n      \r\n            this.moveTo(n.start.x, n.start.y);\r\n            this.lineTo(n.end.x, n.end.y)\r\n            this.stroke();\r\n          //  }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    GetEdges() {\r\n        return this.edges\r\n    }\r\n\r\n    GetCells = function () {\r\n        return this.cells\r\n    }\r\n    insertParabola = function (p: Point) {\r\n        if(!this.root){this.root = new VParabola(p); this.fp = p; return;}\r\n\t\r\n        if(this.root.isLeaf && this.root.site.y - p.y <0.01)\t// degenerovaný případ - první dvě místa ve stejné výšce\r\n        {\r\n            this.root.isLeaf = false;\r\n            this.root.left = new VParabola(this.fp);\r\n            this.root.right = new VParabola(p);\r\n            var s = new Point((p.x+this.fp.x)/2, this.height);\r\n            if(p.x>this.fp.x) this.root.edge = new VEdge(s, this.fp, p);\r\n            else this.root.edge = new VEdge(s, p, this.fp);\r\n            this.edges.push(this.root.edge);\r\n            return;\r\n        }\r\n        \r\n        var par = this.GetParabolaByX(p.x);\r\n        \r\n        if(par.cEvent)\r\n        {\r\n            this.queue.remove(par.cEvent);\r\n            par.cEvent = null;\r\n        }\r\n    \r\n        var start = new Point(p.x, this.GetY(par.site, p.x));\r\n        \r\n        var el = new VEdge(start, par.site, p);\r\n        var er = new VEdge(start, p, par.site);\r\n        \r\n        el.neighbour = er;\r\n        this.edges.push(el);\r\n        \r\n        par.edge = er;\r\n        par.isLeaf = false;\r\n        \r\n        var p0 = new VParabola(par.site);\r\n        var p1 = new VParabola(p);\r\n        var p2 = new VParabola(par.site);\r\n        \r\n        par.right = p2;\r\n        par.left = new VParabola(null);\r\n        par.left.edge = el;\r\n    \r\n        par.left.left = p0;\r\n        par.left.right = p1;\r\n        \r\n        this.CheckCircle(p0);\r\n        this.CheckCircle(p2);\r\n    }\r\n\r\n    RemoveParabola(e: VEvent) {\r\n        var p1 = e.arch;\r\n\t\r\n        var xl = this.GetLeftParent(p1);\r\n        var xr = this.GetRightParent(p1);\r\n            \r\n        var p0 = this.GetLeftChild(xl);\r\n        var p2 = this.GetRightChild(xr);\r\n        \r\n        if(p0.cEvent){this.queue.remove(p0.cEvent); p0.cEvent = null;}\r\n        if(p2.cEvent){this.queue.remove(p2.cEvent); p2.cEvent = null;}\r\n                    \r\n        var p = new Point(e.point.x, this.GetY(p1.site, e.point.x));\r\n    \r\n        \r\n        if(p0.site.cell.last == p1.site.cell.first ) p1.site.cell.addLeft(p);\r\n        else p1.site.cell.addRight(p);\r\n        \r\n        p0.site.cell.addRight(p);\r\n        p2.site.cell.addLeft(p);\r\n        \r\n        this.lasty = e.point.y;\r\n            \r\n        xl.edge.end = p;\r\n        xr.edge.end = p;\r\n        \r\n        var higher;\r\n        var par = p1;\r\n        while(par != this.root)\r\n        {\r\n            par = par.parent;\r\n            if(par == xl) {higher = xl;}\r\n            if(par == xr) {higher = xr;}\r\n        }\r\n        \r\n        higher.edge = new VEdge(p, p0.site, p2.site);\r\n    \r\n        this.edges.push(higher.edge);\r\n        \r\n        var gparent = p1.parent.parent;\r\n        if(p1.parent.left == p1)\r\n        {\r\n            if(gparent.left  == p1.parent) gparent.left  = p1.parent.right;\r\n            else p1.parent.parent.right = p1.parent.right;\r\n        }\r\n        else\r\n        {\r\n            if(gparent.left  == p1.parent) gparent.left  = p1.parent.left;\r\n            else gparent.right = p1.parent.left;\r\n        }\r\n        \r\n        this.CheckCircle(p0);\r\n        this.CheckCircle(p2)\r\n    }\r\n\r\n    FinishEdge(n) {\r\n        var mx;\r\n        if(n.edge.direction.x > 0.0)\r\n        {\r\n            mx = Math.max(this.width, n.edge.start.x + 10 );\r\n        }\r\n        else\r\n        {\r\n            mx = Math.min(0.0, n.edge.start.x - 10);\r\n        }\r\n        n.edge.end = new Point(mx, n.edge.f*mx + n.edge.g);\r\n        \r\n        if(!n.left.isLeaf)  this.FinishEdge(n.left);\r\n        if(!n.right.isLeaf) this.FinishEdge(n.right);\r\n    }\r\n\r\n    GetXOfEdge(par,y) {\r\n       \r\n\tvar left =\tthis.GetLeftChild (par);\r\n\tvar right =\tthis.GetRightChild(par);\r\n\t\t\t\r\n\tvar p = left.site;\r\n\tvar r = right.site;\r\n\t\r\n\tvar dp = 2*(p.y - y);\r\n\tvar a1 = 1/dp;\r\n\tvar b1 = -2*p.x/dp;\r\n\tvar c1 = y+dp*0.25 + p.x*p.x/dp;\r\n\t\r\n\tdp = 2*(r.y - y);\r\n\tvar a2 = 1/dp;\r\n\tvar b2 = -2*r.x/dp;\r\n\tvar c2 = y+dp*0.25 + r.x*r.x/dp;\r\n\t\r\n\tvar a = a1 - a2;\r\n\tvar b = b1 - b2;\r\n\tvar c = c1 - c2;\r\n\t\r\n\tif(a==0) return -c/b;\r\n\t\r\n\tvar disc = b*b - 4 * a * c;\r\n\tvar x1 = (-b + Math.sqrt(disc)) / (2*a);\r\n\tvar x2 = (-b - Math.sqrt(disc)) / (2*a);\r\n\r\n\tvar ry;\r\n\tif(p.y < r.y ) ry =  Math.max(x1, x2);\r\n\telse ry = Math.min(x1, x2);\r\n\t\r\n\treturn ry;\r\n    }\r\n\r\n    GetParabolaByX(xx) {\r\n        {\r\n            var par = this.root;\r\n            var x = 0;\r\n            \r\n            while(!par.isLeaf)\r\n            {\r\n                x = this.GetXOfEdge(par, this.ly);\r\n                if(x>xx) par = par.left;\r\n                else par = par.right;\t\t\t\t\r\n            }\r\n            return par;\r\n        }\r\n    }\r\n\r\n    GetY(p, x) {\r\n        var dp = 2*(p.y - this.ly);\r\n        var b1 = -2*p.x/dp;\r\n        var c1 = this.ly+dp/4 + p.x*p.x/dp;\r\n        \r\n        return(x*x/dp + b1*x + c1);\r\n    }\r\n\r\n    CheckCircle(b) {\r\n        var lp = this.GetLeftParent(b);\r\n\tvar rp = this.GetRightParent(b);\r\n\t\r\n\tvar a = this.GetLeftChild(lp);\r\n\tvar c = this.GetRightChild(rp);\r\n\t\r\n\tif(!a || !c || a.site == c.site) return;\r\n\t\r\n\tvar s = this.GetEdgeIntersection(lp.edge, rp.edge);\r\n\tif(!s) return;\r\n\t\r\n\tvar d = Point.distance(a.site, s);\r\n\t//if(d > 5000) return;\r\n\tif(s.y - d  >= this.ly) return;\r\n\t\r\n\tvar e = new VEvent(new Point(s.x, s.y - d), false);\r\n\t\r\n\tb.cEvent = e;\r\n\te.arch = b;\r\n\tthis.queue.enqueue(e);\r\n    }\r\n\r\n    GetEdgeIntersection(a, b) {\r\n        var I = this.GetLineIntersection(a.start, a.B, b.start, b.B);\r\n\t\r\n        // wrong direction of edge\r\n        var wd = \t(I.x - a.start.x)*a.direction.x<0 || (I.y - a.start.y)*a.direction.y<0\t\r\n                 ||\t(I.x - b.start.x)*b.direction.x<0 || (I.y - b.start.y)*b.direction.y<0;\t\r\n                 \r\n        if(wd) return null;\r\n        return I;\r\n    }\r\n\r\n    GetLeft(t) {\r\n        return this.GetLeftChild(this.GetLeftParent(t))\r\n    }\r\n\r\n    GetRight = function (t) {\r\n        return this.GetRightChild(this.GetRightParent(t))\r\n    }\r\n\r\n    GetLeftParent = function (n) {\r\n        var par = n.parent;\r\n        var pLast = n;\r\n        while(par.left == pLast) \r\n        { \r\n            if(!par.parent) return null;\r\n            pLast = par; par = par.parent; \r\n        }\r\n        return par;\r\n    }\r\n\r\n    GetRightParent = function (n) {\r\n        var par = n.parent;\r\n        var pLast = n;\r\n        while(par.right == pLast) \r\n        {\t\r\n            if(!par.parent) return null;\r\n            pLast = par; par = par.parent;\t\r\n        }\r\n        return par;\r\n    }\r\n\r\n    GetLeftChild = function (n) {\r\n        if(!n) return null;\r\n        var par = n.left;\r\n        while(!par.isLeaf) par = par.right;\r\n        return par;\r\n    }\r\n\r\n    GetRightChild = function (n) {\r\n        if(!n) return null;\r\n        var par = n.right;\r\n        while(!par.isLeaf) par = par.left;\r\n        return par;\r\n    }\r\n\r\n\r\n\r\n}\r\n\r\n\r\n"]}